<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Mi Tarik Station</title>
  <style>
    body { font-family: Arial; margin: 20px; }
    .item { border: 1px solid #ccc; padding: 10px; margin-bottom: 10px; display: flex; align-items: center; }
    .item img { width: 100px; height: 100px; margin-right: 10px; }
    .item-name { font-weight: bold; }
    .item-price { margin-left: auto; }
    #fpx-fields { display: none; margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Welcome to Mi Tarik Station</h1>
  <div id="menu-container"></div>

  <h2>Your Details</h2>
  <label>Name: <input type="text" id="customer-name" required></label><br>
  <label>Order Type:
    <select id="order-type">
      <option value="Dine-In">Dine-In</option>
      <option value="Takeaway">Takeaway</option>
      <option value="Online">Online</option>
    </select>
  </label><br><br>

  <h3>Payment Method</h3>
  <select id="payment-method" onchange="toggleFPXFields()">
    <option value="cash">Cash</option>
    <option value="fpx">FPX Online Banking</option>
  </select>

  <div id="fpx-fields">
    <label>Bank Type: <input type="text" id="bank"></label><br>
    <label>Username: <input type="text" id="fpx-username"></label><br>
    <label>Password: <input type="password" id="fpx-password"></label><br>
  </div>

  <button onclick="submitOrder()">Submit Order</button>

  <script>
    const MENU_URL = "https://mi-tarik-server.onrender.com/menu";
    const ORDER_URL = "https://mi-tarik-server.onrender.com/order";
    let menuItems = [];

    async function loadMenu() {
      try {
        const res = await fetch(MENU_URL);
        menuItems = await res.json();
        const container = document.getElementById("menu-container");
        container.innerHTML = "";
        menuItems.forEach((item, index) => {
          const div = document.createElement("div");
          div.className = "item";
          div.innerHTML = `
            <img src="${item.image_url}" alt="${item.name}">
            <span class="item-name">${item.name}</span>
            <span class="item-price">RM ${item.price.toFixed(2)}</span>
            <input type="checkbox" id="item-${index}" style="margin-left:10px;">
          `;
          container.appendChild(div);
        });
      } catch (err) {
        alert("Failed to load menu.");
      }
    }

    function toggleFPXFields() {
      const method = document.getElementById("payment-method").value;
      document.getElementById("fpx-fields").style.display = method === "fpx" ? "block" : "none";
    }

    async function submitOrder() {
      const name = document.getElementById("customer-name").value.trim();
      const type = document.getElementById("order-type").value;
      const method = document.getElementById("payment-method").value;

      if (!name) return alert("Please enter your name.");

      const selectedItems = [];
      let total = 0;

      menuItems.forEach((item, index) => {
        const checkbox = document.getElementById(`item-${index}`);
        if (checkbox && checkbox.checked) {
          selectedItems.push(item);
          total += item.price;
        }
      });

      if (selectedItems.length === 0) return alert("Please select at least one item.");

      const payment = { method };
      if (method === "fpx") {
        payment.bank = document.getElementById("bank").value.trim();
        payment.username = document.getElementById("fpx-username").value.trim();
        payment.password = document.getElementById("fpx-password").value.trim();
        if (!payment.bank || !payment.username || !payment.password)
          return alert("Please fill all FPX payment details.");
      }

      const order = {
        name,
        type,
        items: selectedItems,
        total,
        payment
      };

      try {
        const res = await fetch(ORDER_URL, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(order)
        });

        if (res.ok) {
          alert("Order submitted successfully!");
          window.location.reload();
        } else {
          alert("Failed to submit order.");
        }
      } catch (err) {
        alert("Error submitting order: " + err);
      }
    }

    loadMenu();
  </script>
</body>
</html>

 
