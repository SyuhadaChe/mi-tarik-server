<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Mi Tarik Station Menu</title>
  <style>
    body { font-family: Arial; padding: 20px; }
    button { margin-top: 10px; }
  </style>
</head>
<body>
  <h1>Mi Tarik Station Menu</h1>
  <form id="orderForm">
    <label>Name: <input type="text" id="name" required></label><br><br>
    <label>Order Type:
      <select id="type">
        <option>Online Order</option>
        <option>Takeaway</option>
        <option>Dine In</option>
      </select>
    </label><br><br>

    <h3>Select Items:</h3>
    <label><input type="checkbox" value="braised beef ramen" data-price="22"> Braised Beef Ramen - RM22.00</label><br>
    <label><input type="checkbox" value="beef ramen" data-price="16"> Beef Ramen - RM16.00</label><br>
    <label><input type="checkbox" value="fried dumpling" data-price="12"> Fried Dumpling - RM12.00</label><br><br>

    <button type="submit">Submit Order</button>
  </form>

  <div id="result"></div>

  <script>
    document.getElementById("orderForm").addEventListener("submit", async function (e) {
      e.preventDefault();
      const name = document.getElementById("name").value.trim();
      const type = document.getElementById("type").value;

      const checkboxes = document.querySelectorAll("input[type='checkbox']:checked");
      const items = [];
      let total = 0;
      checkboxes.forEach(cb => {
        const price = parseFloat(cb.dataset.price);
        items.push({ name: cb.value, price });
        total += price;
      });

      if (items.length === 0) {
        alert("Please select at least one item.");
        return;
      }

      const order = { name, type, items, total };

      try {
        const res = await fetch("https://mi-tarik-server.onrender.com/order", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify(order)
        });

        const result = document.getElementById("result");

        if (res.ok) {
          result.innerHTML = "<p style='color: green;'>Order submitted successfully!</p>";
        } else {
          const errorText = await res.text();
          result.innerHTML = `<p style='color: red;'>Server error: ${res.status} - ${errorText}</p>`;
        }
      } catch (err) {
        document.getElementById("result").innerHTML = "<p style='color: red;'>Failed to connect to server.</p>";
        console.error(err);
      }
    });
  </script>
</body>
</html>
